<!DOCTYPE HTML>
<html lang="en">

<head>
    <title>闭包</title>
    <meta charset="utf-8">
</head>

<body>

    <script>
        var promise = new Promise(function(resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
                        reject(new Error('haha'));
                        resolve(xhr.responseText);
                    }
                }
            };
            xhr.open('get', 'example.txt', true);
            xhr.send();
        });
        promise.then(function(value) {
            console.log(value);
        }).catch(function(error) {
            console.log(error);
        })
    </script>
</body>

</html>